const taskForm = document.getElementById('task-form');
const taskList = document.getElementById('task-list');

taskForm.addEventListener('submit', addTask);

// Fetch and display existing tasks when the page loads
fetch('/tasks')
  .then(response => response.json())
  .then(tasks => {
    tasks.forEach(task => {
      displayTask(task);
    });
  })
  .catch(error => {
    console.error('Error:', error);
  });

function addTask(event) {
  event.preventDefault();

  const titleInput = document.getElementById('title');
  const descriptionInput = document.getElementById('description');
  const dueDateInput = document.getElementById('due-date');

  const task = {
    title: titleInput.value,
    description: descriptionInput.value,
    dueDate: dueDateInput.value
  };

  fetch('/tasks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(task)
  })
    .then(response => response.json())
    .then(savedTask => {
      displayTask(savedTask);
      titleInput.value = '';
      descriptionInput.value = '';
      dueDateInput.value = '';
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

function displayTask(task) {
  const li = document.createElement('li');
  li.innerHTML = `
    <h3>${task.title}</h3>
    <p>${task.description}</p>
    <p>Due Date: ${task.dueDate}</p>
    <button onclick="deleteTask(${task.id})">Delete</button>
  `;
  li.setAttribute('id', `task-${task.id}`);
  taskList.appendChild(li);
}

function deleteTask(taskId) {
  fetch(`/tasks/${taskId}`, {
    method: 'DELETE'
  })
    .then(() => {
      const taskItem = document.getElementById(`task-${taskId}`);
      taskItem.remove();
    })
    .catch(error => {
      console.error('Error:', error);
    });
}
